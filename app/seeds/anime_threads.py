from app.models import db, Category, environment, SCHEMA, Thread, Post, User, SubCategory
from sqlalchemy.sql import text


# Adds a demo user, you can add other users here if you want
def seed_threads():
    user = User.query.get(1)
    category = Category.query.filter_by(name='Anime Manga and VNs').first()
    subcategory=SubCategory.query.filter_by(name='When the Seagulls Cry').first()
    thread1= Thread(
        user=user,
        categories=[category],
        subcategories=[subcategory],
        views=0,
        subject="Facts overview",
        text="""<h2 style="margin-left:560px;"><span class="text-huge">Facts overview</span></h2><p>These are some very basic facts about the series that should be kept in mind at all times. Since you should have already read the series (right? RIGHT!?), you can consider this as a quick reminder. :P</p><ul><li>There are two faces to the story, the “chessboard” and the “meta world”. The “chessboard” is the real world, or rather as we later learn, an -interpretation- of the real world events at Rokkenjima based on the bottled messages written by Yasu/Beatrice and later the in-universe novels based on Hachijo Tohya’s (aka an amnesiac, unbalanced Battler’s) incomplete memories.</li><li>The “meta world” is, well, kind of complicated. It is a place filled with Yasu’s alternate personalities, imaginary friends and other magical beings, some of them imagined by the other “witches” or personifications of mystery rules and whatnot. Contrary of what’s shown, the two realms do not interact with each other directly and the “meta world” only exists in the fiction part of the story (though, even with all the torture and mind-rapes, it is still the more entertaining and lighthearted part of the story… go figure…).</li><li>Shannon=Kanon=”Beatrice”=Yasu: Yasu is the core character here. He/She is the son/daughter of Ushiromiya Kinzo from Beatrice the second (who herself is the illegitimate daughter of Kinzo and the original “witch”, Beatrice Castigloni). She/He suffers from disassociative personality disorder, possibly either because of her heavily incestuous origins, his/her damaged body or because of her treatment as she/he grew up. Shannon and Kanon are two of her alternate personalities, while Beatrice is the personality that was created for and by Battler and his promise. She is the main instigator of the murders, triggered by Battler’s return to the island.</li><li>Her gender is ambiguous, but I will treat her as female for the sake of simplicity and because most of her Personae are female.</li><li>The narrator is unreliable. No, let me stress that again: THE NARRATOR IS VERY, VERY UNRELIABLE!!!</li><li>Whenever something is not observed directly by the “chessboard” Battler (or whoever is the “detective” in that chapter), it is safe to assume that it simply did not happen, or happened in a way that is wildly different from what is told. In fact I have to go even further: Even if it was observed by them, if they are indisposed or the story is not told directly from their point of view, the narration is still completely unreliable.</li><li>There is no traditional “magic” on the “chessboard”. Period. However, as the story goes on, it clearly becomes harder to separate the chessboard from the meta-world as the story becomes more and more fictionalized and the narrator less and less reliable. If we are at that, technically none of the chessboard-stories actually happened, they are all just chaotic interpretations and fictionalizations of the events and the writing of Hachijo Tohya, who is actually Ushiromiya Battler, who survived Rokkenjima but suffered brain-damage and thus cannot identify with his memories and tries to reconcile with them this way.</li><li>Magic itself is liberally used to refer to lies, deception, sleight of hand or anything else that makes other people believe something that is untrue. So, for example, when Shannon tells George that their relationship exists because of Beatrice’s magic, it actually means that their relationship was built on a huge fat lie. The same is true for miracles and any other supernatural things in the story.</li><li>Kinzo is dead for about a year before the beginning of all the scenarios. His death is kept secret by the household to postpone the dividing the inheritance and cover Krauss’ embezzlement. The only times he -really- appears are in flashbacks, and in later Episodes even those are questionable.</li><li>The red truth is NOT the gospel, nor are the Ten Rules of Knox. They are actually used for misleading as many if not more often than to give clues thanks to the sneaky multiple interpretations of their meaning and the characters’ tendency to use the wrong questions and then getting “technical” truths that are actually true but are not relevant to the question or mask its true answer.</li><li>For example, saying that there are <span style="color:rgb(255,0,0);">“No more than 17 humans exist on this island!!”</span> twists the truth on two accounts: first off, humans =/= persons (or rather, persona’s), and the wording also hides the truth that there are actually 16 people (as in, persons with individual bodies) on the island, which is technically “no more than 17”, but is still misleading.</li></ul>"""
        )
    db.session.add(thread1)

    thread2=Thread(
        user=user,
        categories=[category],
        subcategories=[subcategory],
        views=0,
        subject='Episode 1: Legend of the Golden Witch (FULL SOLUTION/ANALYSIS)',
        text="""<h2 style="margin-left:280px;">Episode 1: Legend of the Golden Witch</h2><h2>Culprits</h2><ul><li>Yasu is the killer</li><li>Nanjo provides fake diagnoses and cover-up</li><li>Genji provides the muscle for moving the bodies and cover-up</li><li>Maria places the letters and provides the magic circles</li><li>Eva and Hideyoshi also know some details and provide cover-up, especially when it comes to the “death” of Shannon</li></ul><p>Furthermore, although a red truth forbids poison gases (<span style="color:rgb(255,0,0);">“There was no poison gas, there was no drowning, there was no death by suffocation!!”</span>), I still presume most of the victims’ food or drinks were drugged to make Yasu able to overpower them. Also, the Red Truth says nothing about gases that do not cause death, or substances such as formalin and chloroform that could possibly knock out the person, or at least disorient them to make them easier to deal with.</p><h2>First Twilight</h2><h3>Description</h3><p>Six bodies were found in the tool-shed, their faces smashed apart, with a magic circle on the shutter. The six were Krauss, Kyrie, Rudolf, Godha, Rosa and Shannon. Out of the six, only Shannon was surely identified thanks to her ring. The shed was locked by a key that was in the servants’ quarters.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“the identities of all unidentified corpses are guaranteed”</span> (Used by Lambdadelta in ????? for Episode 1.)</li></ol><h3>Explanation</h3><p>The method of the murder is irrelevant. Based on the blood-stains in the dining hall, the actual killing caused only minor bleeding, so it was either a relatively small stab wound, or, more likely, blunt force trauma directly to the head. Either way, the end result is the same.</p><h3>Further Details</h3><p>The faces were destroyed to protect Yasu’s identity as Shannon/Kanon and to keep the modus operandi consistent. It is also notable that neither George (the person closest to her who was not in on the murders) nor Battler (our only reliable narrator) have seen her face, only Hideyoshi.</p><p>However, it is quite possible that Eva and Hideyoshi are forced or bribed into becoming Yasu’s accomplices at this point, thus it is not only possible that Hideyoshi lied and Shannon’s corpse weren’t even there, but highly probable.</p><p>The funniest thing though is that the Red Truth regarding unidentified corpses specifically allows Shannon’s corpse to be non-guaranteed. One one hand, it is described as being only half-smashed and thus she was not “unidentified”. On the other hand, there was no “corpse” to begin with (as in, Yasu was either still alive or there was no body at all to begin with). In short, Yasu dodges the Red not once but twice!</p><h3>Special Circumstances</h3><p>Maria’s involvement was made especially obvious by the magic circle, which was more than likely drawn by her on the first place, thus explaining why she knew so much about it. The same goes for all the other magic symbols throughout the episode. The circumstances relating to the shed’s key and the locked mansion doors are irrelevant, as the servants have the keys for both.</p><h2>Kinzo’s disappearance</h2><h3>Description</h3><p>In the morning, Eva “sealed” the door to Kinzo’s study with a receipt so that she would know if the door was opened afterwards. When they later enter the room again and Kinzo was missing, she questions Natsuhi about how Kinzo could have disappeared without opening the door.</p><h3>Method</h3><p>Kinzo was never in his room to begin with, so there was no-one to leave on the first place. I think it is pretty self-explanatory.</p><h2>Second Twilight</h2><h3>Description</h3><p>Eva and Hideyoshi were killed in their own room. They had to cut the door-chain to get inside, and in there they were found with stakes in their foreheads. Eva was on the bed, out of view from the door, while Hideyoshi was in the shower.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“Both were killed by another person!”</span> (This is referring to the second twilight of Episode 1.)</li><li><span style="color:rgb(255,0,0);">“It is not the case that, after the construction of the closed room, one of them committed suicide after committing murder!”</span></li><li><span style="color:rgb(255,0,0);">“Furthermore, the murder was carried out with both the victim and the perpetrator in the same room!”</span></li><li><span style="color:rgb(255,0,0);">“No method exists for the perpetrator to commit murder from outside the room!”</span></li></ol><h3>Explanation</h3><p>The method of the murder is, once again, irrelevant. It was shown that, through the unreliable narration, the servants could have murdered the two any way they wanted to (though Yasu probably just shot them) and then stake them and position their bodies however they wanted.</p><h3>Further Details</h3><p>The stakes were drilled into their bodies postmortem, or rather they were played in the gun-wounds, the effect is the same.</p><p>The closed room is solved by the unreliable narration. Contrary to what is “shown”, the following is what really happened: They opened the door with the master key, Kanon cut the chain, they killed the two, and then pretended to find the corpses alongside the rest of the family and that they only just recently “had to cut the chain” to get inside.</p><h2>Fourth Twilight</h2><h3>Description</h3><p>Kinzo’s body was found in the furnace of the boiler room, with a stake in his forehead. His body was charred and could only be identified by his extra toe.</p><h3>Explanation</h3><p>Kinzo was not murdered, he has been dead for a while thanks to natural causes. His body was hidden in the furnace and was recently doctored by adding the stake to his forehead.</p><h2>Fifth Twilight</h2><h3>Description</h3><p>Kanon was found on the floor of the boiler room, bloodied with an apparent wound on his chest, with the bloody stake next to him.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“Kanon did not die in an accident!”</span> (This refers to Kanon’s death in Episode 1.)</li><li><span style="color:rgb(255,0,0);">“Kanon did not commit suicide”</span></li><li><span style="color:rgb(255,0,0);">“All of the survivors have alibis! Let us include the dead as well!! In short, no kind of human or dead person on the island could have killed Kanon!”</span></li></ol><h3>Explanation</h3><p>Kanon wasn’t murdered either. He faked his death with the help of Nanjo’s fake diagnosis. No one has actually seen him being stabbed, with the stake in his chest, and people only judged how serious his injury was based on the bloodstain on the stake. There is no objective observation about him being actually wounded.</p><h2>The Witch’s Third letter</h2><h3>Description</h3><p>Everyone is locked in Kinzo’s study, when a letter appears on the table while they weren’t looking.</p><h3>Explanation</h3><p>Maria put the letter there. She was the one who pointed it out on the first place, and the goal of the letter was to single the accomplices out so that they could get out of the study.</p><h2>Sixth, Seventh and Eighth Twilights</h2><h3>Description</h3><p>Genji’s, Kumasawa’s and Nanjo’s bodies were found in the lounge, their faces smashed and the bodies mangled. Maria was found facing the wall and singing, and she says she was told to do so by the witch. The door was locked from the inside.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“Maria, who was in the same room, did not kill them!”</span> (This is referring to the deaths of Genji, Nanjo, and Kumasawa in Episode 1.)</li><li><span style="color:rgb(255,0,0);">“Genji, Kumasawa, and Nanjo are not killers.”</span> (This refers to their deaths in Episode 1.)</li><li><span style="color:rgb(255,0,0);">“And of course, the three were killed by other people!”</span></li><li><span style="color:rgb(255,0,0);">“Regarding the unidentified corpses, all of their identities are guaranteed. Therefore, no body double tricks exist!”</span></li></ol><h3>Explanation</h3><p>The three were killed by Yasu. It is entirely possible they were drugged beforehand, though not necessary. Maria was on the sidelines during all this.</p><h3>Further Details</h3><p>The door was locked by Maria from the inside to create the illusion of a locked room.</p><h2>Natsuhi’s Death</h2><h3>Description</h3><p>Natsuhi appeared to have had committed suicide by shooting herself in the forehead in the hallway. It appeared there is no one left on the island who could have done it.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“Natsuhi was killed by another person!”</span> (This is referring to Natsuhi’s death in Episode 1.)</li><li><span style="color:rgb(255,0,0);">“There are no unidentified corpses, and all of the survivors have alibis!”</span></li><li><span style="color:rgb(255,0,0);">“The bullet buried into Natsuhi’s forehead was not fired from Natsuhi’s gun!”</span></li><li><span style="color:rgb(255,0,0);">“The thing that shot Natsuhi wasn’t a trap, it was a real shooting murder with a gun raised and trigger pulled!”</span> (This refers to her death in Episode 1.)</li></ol><h3>Explanation</h3><p>There was more than one gun to begin with, and so Yasu was easily able to kill Natsuhi while the cousins were locked inside the lounge. By the time they got out, Yasu was gone, replaced her gun with the killer weapon, and so it appeared that Natsuhi shot herself once the cousins found her.</p>"""
        )
    db.session.add(thread2)

    thread3=Thread(
        user=user,
        categories=[category],
        subcategories=[subcategory],
        views=0,
        subject='Episode 2: Turn of the Golden Witch (FULL SOLUTION/ANALYSIS)',
        text="""<h2>Episode 2: Turn of the Golden Witch</h2><h2>Culprits</h2><ul><li>Yasu is the killer.</li><li>Genji is the main accomplice, but he only sets things up for her.</li><li>Godha was probably threatened or paid off into playing along.</li><li>Rosa was the front-woman.</li></ul><h2>Rosa’s Motivation</h2><p>This time Rosa plays the same role as Eva in EP1: she provides the argument with Battler and nudges him towards the truth. The reason why she would side with Yasu is complex. First off, she needs money. She also had a bad relationship with her siblings. Finally, she learns that Kinzo is dead and his death was kept secret. That, combined with the gold in Yasu’s possession, would mean that she had all the financial and psychological incentive to betray her siblings.</p><h2><i>Guest </i>Beatrice’s Identity</h2><h3>Description</h3><p>An actual 19th(sic) person, Beatrice, appeared on the island. She was seen by Rosa, Maria and Kyrie and was acknowledged by the servants.</p><h3>Explanation</h3><p>Rosa and Maria seeing her was clearly a pseudo-event, therefore the narration cannot be trusted. Considering the later events, it is fairly certain that Rosa became an accomplice at that point. However, Kyrie’s account, while the narrated event is still doubtful, can be considered genuine, as she stated that she met her in front of Battler and was killed in the first twilight, therefore it can be said with a high certainty that she wasn’t an accomplice who would lie about something like this.</p><p>Therefore, it is fairly certain that there was an actual person dressed as Beatrice. It is also notable that she did not address herself as Beatrice and that Kyrie noted her resemblance to the portrait, meaning it is almost certain that it was Yasu.</p><h2>First Twilight</h2><h3>Description</h3><p>Krauss, Eva, Rudolf, Natsuhi, Hideyoshi and Kyrie were found in the chapel around a table full of Halloween decorations and with three gold bars. Their stomachs were cut open and stuffed with sweets.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“Regardless of whether they were living or dead, the six people definitely entered through the door”</span> (Refers to the six murders in the chapel.)</li><li><span style="color:rgb(255,0,0);">“Only one key to the chapel exists”</span></li><li><span style="color:rgb(255,0,0);">“It is impossible to unlock the lock to the chapel without the chapel’s key”</span></li><li><span style="color:rgb(255,0,0);">“When the door to the chapel is locked, it prevents any and all methods of entry or exit”</span></li><li><span style="color:rgb(255,0,0);">“Six people definitely entered through ‘this front door’”</span></li><li><span style="color:rgb(255,0,0);">“This morning, Rosa definitely took an envelope out of Maria’s handbag, and thereby obtained the genuine key to the chapel”</span> (This morning refers to the morning of the second day.)</li><li><span style="color:rgb(255,0,0);">“The key to the chapel truly was the object inside the envelope I gave Maria”</span></li><li><span style="color:rgb(255,0,0);">“The letter that I handed over to Maria and the one Rosa opened are the same thing”</span></li><li><span style="color:rgb(255,0,0);">“Starting when Maria’s key was received, and until the instant Rosa unsealed it the next day, it passed through no one’s hands!!”</span></li><li><span style="color:rgb(255,0,0);">“When the six were killed in the chapel, the culprit was inside the chapel!”</span></li></ol><h3>Explanation</h3><p>There are two possibilities: The six victims were either knocked out and were taken to the chapel during the night, or they went there on their own accord in order to meet with Beatrice and got put to sleep/poisoned during the meeting. The latter would also explain the gold bars found at the scene.</p><p>The door was never locked to begin with, so they needed no key. Whether the table was prepared beforehand or during the night is inconsequential. Once they were unconscious/dead, their stomachs were cut open by Yasu (therefore fulfilling #10) and they were filled up with sweets.</p><p>Then, in the morning, Rosa went to the cousin’s room to get the key (or rather, to get Maria’s notebook for the magic circle but took the key as well, fulfilling #6, #7 and #9. Once the preparations were complete they called for Nanjo and the cousins followed, thus allowing Battler to witness the scene.</p><h3>Further Details</h3><p>This time around the circle wasn’t Maria’s doing but Rosa’s, as it was directly foreshadowed that she had access to Maria’s notebook with the detailed drawings.</p><p>The gold bars are explained by that Yasu’s presence who had solved the epitaph a while back, thus giving her the money needed for the bribery of Rosa and others.</p><h2>Second Twilight</h2><h3>Description</h3><p>Jessica is found dead in her room with a stake in her back. The room was locked from the outside and Kanon’s body was missing.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“The only master keys are the ones that each servant holds, one per person”</span> (Used by Beatrice in Chapter 12: A Suspect.)</li><li><span style="color:rgb(255,0,0);">“there are absolutely no types of hidden doors”</span> (The location in discussion refers to Jessica’s room.)</li><li><span style="color:rgb(255,0,0);">“This door is the only way in or out”</span></li><li><span style="color:rgb(255,0,0);">“The only way to lock this door is with Jessica’s single key or the master keys, only one of which is held by each servant”</span></li><li><span style="color:rgb(255,0,0);">“the window is locked from the inside”</span></li><li><span style="color:rgb(255,0,0);">“Kanon was killed in this room”</span></li><li><span style="color:rgb(255,0,0);">“When locked, entry is not possible by any means”</span></li><li><span style="color:rgb(255,0,0);">“No trick could have the effect of locking the door from the outside without using a key”</span></li><li><span style="color:rgb(255,0,0);">“There are no hidden doors in this room”</span> (This text refers back to Statement 12, in the same context.)</li><li><span style="color:rgb(255,0,0);">“There is no way to get in or out other than the door and the window”</span></li><li><span style="color:rgb(255,0,0);">“Entry or exit is impossible except for the single door and single window”</span></li><li><span style="color:rgb(255,0,0);">“And those were both locked”</span></li><li><span style="color:rgb(255,0,0);">“The door and the window do not permit any kind of entry or exit when they are locked”</span></li><li><span style="color:rgb(255,0,0);">“No one exists in this room except all of you. ‘All of you’ refers to Battler, George, Maria, Rosa, Genji, Gohda, and Shannon”</span></li><li><span style="color:rgb(255,0,0);">“When Jessica’s corpse was discovered, only Battler, George, Maria, Rosa, Genji, Gohda, Shannon, Kumasawa, and Nanjo were in Jessica’s room”</span></li><li><span style="color:rgb(255,0,0);">“[Whoops, the corpse of] Jessica is also included”</span></li><li><span style="color:rgb(255,0,0);">“Therefore, both in the case of Jessica’s room and the case in this servants’ room, no humans exist that are you were not aware of”</span></li><li><span style="color:rgb(255,0,0);">“No one is hiding”</span></li><li><span style="color:rgb(255,0,0);">“Regarding the window, no method exists by which it could somehow be locked from the outside”</span></li></ol><h3>Explanation</h3><p>Yasu discarded Kanon while inside the room (fulfilling #6) and killed Jessica by stabbing her in the back. Afterwards Yasu used her second master key (established by #4) to lock the door from the outside and then changed into Shannon.</p><h3>Further Details</h3><p>The magic circle on the outside of the door was written up using Maria’s notes.</p><p>The master-key issue is circumvented by Yasu actually having two master keys, therefore she could lock the door with Shannon’s key.</p><p>A huge number of red truths referring to this “closed room” is inconsequential, since they are just denying Battler’s random potshots at the solution.</p><p>The reason why the door was locked on the first place with a master-key can have multiple reasons. First off, it could have been used to put the blame on Kanon and thus let the rest of the servants move freely (which was torpedoed by Battler), but it could have also been a deliberate clue by Yasu for Battler to pick up on, namely the explanation as of why Kanon would have two master keys.</p><h2>The Final Letter</h2><h3>Description</h3><p>Battler finds a sealed letter inside the parlor. The doors and windows were all locked.</p><h3>Explanation</h3><p>It was Rosa who put the letter there. It was explicitly shown that she went back and checked all the windows before they left, giving her ample time to leave the letter there.</p><h2>The Final Scenes</h2><h3>Description</h3><p>Genji leads Battler into Kinzo’s study where he meets with Kinzo and Beatrice.</p><h3>Explanation</h3><p>We do know for sure that Kinzo is dead from the very beginning, so the entire scene is in the pseudo-realm. Since Battler is drunken at this point, it absolves his detective-privileges of objective observation. The rest of the people on the island die when the bomb goes off.</p>
            """
              )
    db.session.add(thread3)
    thread4=Thread(
        user=user,
        categories=[category],
        subcategories=[subcategory],
        views=0,
        subject="Episode 3: Banquet of the Golden Witch (FULL SOLUTION/ANALYSIS)",
        text="""<h2>Episode 3: Banquet of the Golden Witch</h2><h2>Culprits</h2><ul><li>Yasu (she commits the original First Twilight murders)</li><li>Eva (secondary killer, the main culprit once things get out of hand from the Second Twilight and onwards)</li><li>Nanjo (accomplice in the First Twilight, once again supplying the fake death diagnoses and drugs)</li><li>Hideyoshi (provides alibi for Eva during the Second Twilight)</li></ul><h2>The Death of Shannon and Kanon</h2><p>In this episode’s establishing scenes, the part between the cousins at the beach was very important, as this time around Battler specifically noted that a.) Shannon was his first love, and more importantly b.) that he believed that his memory could be jogged to the point where he could remember what he said six years ago, which might just been enough motivation to explain how the Beatrice persona was able to cast away the other two personae, explaining how both of them ‘died’ during the first twilight.</p><h2>1st Twilight</h2><h3>Description</h3><p>Six bodies are found in locked rooms, with magic circles painted on the doors. The first body is Shannon’s, it was found on the first floor parlor by breaking through a window. She had her master key and an envelope with the key for the second floor guest room. In that room, Kumasawa’s body was found with her master key and another envelope with the key for the third floor waiting room. In that room, Gohda’s corpse was found with his master key and an envelope with the key to the second floor VIP room. In that room, Genji’s corpse was found with his master key and an envelope with the key to the underground boiler room. In that room, Kinzo’s body was found, with the key to the chapel. Finally, inside the chapel, Kanon’s body was found with his master key and the key to the first floor parlor, which closed the circle.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“There are five, one for each servant.”</span> (Used by Beatrice in Chapter 9: Skirmish. It refers to the master keys in this game.)</li><li><span style="color:rgb(255,0,0);">“Furthermore, all of the doors and windows in the 6 rooms are normal.”</span> (The six rooms in this statement refers to the parlor, the chapel, the boiler room, the VIP room, the waiting room, and the guest room.)</li><li><span style="color:rgb(255,0,0);">“No device exists which can lock them without a key, such as an auto-lock.”</span></li><li><span style="color:rgb(255,0,0);">“6 people: Kinzo, Genji, Shannon, Kanon, Gohda, and Kumasawa are dead!”</span></li><li><span style="color:rgb(255,0,0);">“There is no one hiding in the six rooms!”</span></li><li><span style="color:rgb(255,0,0);">“The six people died instantly!”</span></li><li><span style="color:rgb(255,0,0);">“Only the victims are inside the rooms, and no other people exist inside the rooms.”</span> (Used by Ronove.)</li><li><span style="color:rgb(255,0,0);">“The six people were not killed by traps”</span> (Used by Beatrice.)</li><li><span style="color:rgb(255,0,0);">“None of the six people committed suicide!”</span></li><li><span style="color:rgb(255,0,0);">“All five master keys were discovered, each in the pocket of one of the servants!”</span> (This is referring to the first twilight of Episode 3.)</li><li><span style="color:rgb(255,0,0);">“The individual keys were found inside envelopes alongside the corpses!”</span></li><li><span style="color:rgb(255,0,0);">“In short, all keys related to the linked closed rooms were locked inside the linked closed rooms!!”</span></li><li><span style="color:rgb(255,0,0);">“The keys cannot be returned from outside the room using the crack of the door, the crack of the window, vents or any place of the sort!!”</span></li><li><span style="color:rgb(255,0,0);">“All of them had wounds resembling gunshot wounds which became fatal!”</span></li><li><span style="color:rgb(255,0,0);">“It is impossible for the murder to have taken place from outside the room!!”</span></li><li><span style="color:rgb(255,0,0);">“I shall say more with the red! When the five other than Kinzo were murdered, the murderer was definitely in the same room!”</span></li><li><span style="color:rgb(255,0,0);">“I already proclaimed in red at the time that there were no suicides!!”</span></li></ol><h3>Explanation</h3><p>Before I dissect this, I have to say that this was my favorite closed room in the entire series. :)</p><p>That said, its trick was relatively simple to figure out once one takes the sequence of the rooms into account, namely that there was only one order they could be opened. The chain had to start with the first floor parlor, as it was the only room which had windows that could be reached from the outside. After Shannon’s (fake) corpse was found inside, the adults had moved on the the next room. Notice the sequence: first floor, second floor, third floor, second floor, basement. Because of this, they had to spend a considerable amount of time moving from place to place, and after they left the parlor, it stopped being a closed room because of the broken window. Thus Shannon got up, left the room through said window, changed into Kanon and entered the chapel, all the while the adults kept running around in the mansion, giving her ample time to do so. The chapel door was, once again, open from the beginning, so she just had to enter, close the door behind her and then fake Kanon’s death.</p><h2>2nd Twilight</h2><h3>Description</h3><p>Maria and Rosa’s corpses were found in the rose garden. Rosa’s body was on the fence, with her medulla oblongata skewered by a pointy ornament on the fence (for the less medically inclined, the medulla oblongata is the area where the brain and the spinal cord connect to each other, stabbing through here is more or less 100% fatal, it’s literally stabbing into the brain itself through the hole at the bottom of the skull). Maria was apparently strangled barehanded.</p><h3>Red Truths</h3><ol><li><span style="color:rgb(255,0,0);">“Rosa and Maria died”</span> (Used by Beatrice in Chapter 13: Warning of Sacrifices.)</li><li><span style="color:rgb(255,0,0);">“The cause of death was as Nanjo diagnosed”</span> (The diagnosis for Maria and Rosa were bare handed strangling and a stab to the medulla oblongata with the pointed gate of the fence, respectively.)</li><li><span style="color:rgb(255,0,0);">“Rosa and Maria were killed by other people”</span> (Used by Ronove in Beatrice’s stead.)</li><li><span style="color:rgb(255,0,0);">“I was in the room the whole time”</span> (Used by Ushiromiya Hideyoshi in EVA-Beatrice’s stead in Chapter 17: The Witch’s Courtroom. The room is referring to the guest house second (sic!) floor room.)</li><li><span style="color:rgb(255,0,0);">“Both before and after the time period of the crime”</span></li></ol><h3>Explanation</h3><p>Funnily enough, Eva practically spells out what happened. The culprit attacked Rosa, she fell back and accidentally skewered her head on the fence. The witness, Maria, was killed via strangling because the guest house was too close and the culprit wanted to avoid firing a gun and gain the adults’ attention. As for who the culprit was, Eva is the obvious answer.</p><p>We were shown that she had a meta-event during the murders (“dreaming” about the death of the two), only Hideyoshi was providing her alibi, and she could easily get out through the window and get back unnoticed (btw, the Umineko Wiki’s red truth page is mistaken in #4 when referring to this twilight, as Hideyoshi’s and Eva’s room was actually on the 1st floor).</p><h3>Further Details</h3><p>The reason why Eva attacked Rosa was probably because of her paranoid mistrust of her telling the siblings about the gold. It is also quite possible that at least Rosa’s death was accidental, as in Eva only tried to get the gun from Rosa, who then slipped and accidentally hit her head the worst way possible. After this things just spiraled out of control by themselves.</p><p>Also note the change in modus operandi: This is the first time the stakes weren’t involved in a twilight past the first one, which is also a clue about there being a different culprit.</p><p>Also, if we try to incorporate the meta-even into the explanation, it is possible that Maria was actually strangled by Yasu instead of Eva, though it makes little difference either way.</p><h3>Further Details</h3><p>The reason why Kyrie and Rudlof wanted to get out was because they suspected that Hideyoshi was covering for Eva and wanted to detain and question him (explaining #1-3). Eva killed the two to cover her tracks.</p><p>Hideyoshi is a special case, as it is assumed that Kyrie, who didn’t receive a fatal wound, tried to shoot Eva, but Hideyoshi shielded her. However, he didn’t die instantly, so Eva returned to the guest house and rushed everyone to the crime scene to save him (note that she specifically requested Nanjo to come along), but by the time they got there Yasu had already done the stakings and thus killed Hideyoshi for good.</p><h3>Further Details</h3><p>It’s actually a little hilarious that #31 pretty much denies witches, but Battler is so caught up in the apparent logical error that he doesn’t even notice it. :P</p>
        """
        )
    db.session.add(thread4)
    thread5=Thread(
        user=user,
        categories=[category],
        subcategories=[subcategory],
        views=0,
        subject='Episode 4: Alliance of the Golden Witch (FULL SOLUTION/ANALYSIS)',
        text="""<h2>Episode 4: Alliance of the Golden Witch</h2><p>Oh boy, this is a weird one. This episode not only has the ridiculously long and multi-layered Ange and Maria subplots, which take up as much if not more screen time than the actual “game” without providing actual clues to the murder mysteries in question (though they do nudge the reader towards a certain mindset that helps in uncovering the overarching mystery), this is also an episode where EVERYONE aside of the cousins are in cahoots with Yasu to some degree. Add to that the fact that this was the first chapter where the Blue Truth appeared to complicate the solutions (in addition to a reduced number of case-relevant Red Truths), and you can clearly see why it took me so long to resolve myself to actually replay this episode and write this. Oh well, I might as well get started…</p><h2>Culprits</h2><ul><li>Yasu (Killer.)</li><li>Krauss (Primary accomplice.)</li><li>Kyrie (Primary accomplice.)</li><li>Godha (Accomplice.)</li><li>Kumasawa (Accomplice.)</li><li>Jessica (Accomplice.)</li><li>Everyone else beside Battler and George (Passive Accomplice)</li></ul><p>Krauss and Kyrie play along believing that they are playing a murder mystery game aimed at Battler. The rest of the adults and the servants are the same, though less involved. The instigator is Yasu who bribes them, along the servants and everyone else, but Krauss and Kyrie are the two who work closely with her and talk to the cousins repeatedly.</p><p>On the other hand the accomplices are separated and mostly left in the dark regarding what Yasu is actually doing and probably none of them are aware of the murders until they get killed off as well.</p><p>Also, while I don’t find it necessary myself, there are compelling arguments pointing at the possibility of Yasu using the threat of the bomb set up under Rokkenjima as a sort of “Insurance Policy” to make sure that at least her most important accomplices (namely Krauss and Kyrie) would stay in line.</p><p>Since this episode barely focuses on the actual murders and even the order in which people died is questionable, I will attempt to first construct an independent timeline instead of going through the usual Twilights.</p><h2>Character Death Reconstruction</h2><p>This episode was especially hard to crack because it has less Red Truths than even EP1! Yes, the episode that didn’t even have the Red Truth invented yet has more of it retroactively because of the later episodes then the last episode of the first tetralogy. Go figure…</p><p>The only solid thing we know about the order of the deaths was that Kanon was the 9th, courtesy of these Red Truths:</p><ol><li><span style="color:rgb(255,0,0);">“Among the five people in Kyrie’s group, he was the first to die.”</span></li><li><span style="color:rgb(255,0,0);">“In short, he was the 9th victim.”</span></li></ol><p>There are two ways this could be possible: Either the six First Twilighters + Jessica and George, or the six First Twilighters + Gohda and Kumasawa had to die before Kanon. In my opinion it’s the latter. My reasoning is as follows:</p><p>It has to start with the six people in the dining hall, otherwise we wouldn’t have our target number of 9th.</p><p>If after that she were to kill one of the cousins, it’s safe to assume that she would have had to “kill” the persona relating to them. Therefore if she were to kill George for 7th, then Shannon would have been “killed” as well, which would contradict #1. However, if she were to kill Jessica first and then “kill” Kanon, then he would have been the 8th at best. I would also argue that killing off the relevant persona would happen -before- the cousin in question is killed, for obvious reasons.</p><p>Therefore the only way both Red Truths could be fulfilled if there were two separate deaths (aka. Gohda and Kumasawa) that would add up to the required 8, so that when Yasu would “kill” Kanon and Shannon in preparation of killing the two cousins they would become the 9th and the 10th.</p><p>Now, for the actual timeline:</p><p>Eva, Rudolph, Rosa, Hideyoshi, Natsuhi and Genji are killed in the dining hall. This probably happens -after- the second phone call by Kyrie requesting that Gohda and Kumasawa would be locked up. Yasu leaves under the guise of letting Kumasawa and Gohda out of the shed but instead she uses the opportunity to go to the dining hall first and kills the people there and then smashes their heads.</p><p>After this she goes to the shed. Gohda gives her the key through the small window, believing that it is still part of the game, but when she opens the shutter she kills them both. Afterwards she props up the bodies as if they were hanged so that when she locks the shutter from the outside she could use a long rod or some other method to easily return the key to the pocket of the now standing Gohda through the window, thus creating a locked room.</p><p>After this point she returns to Kyrie and co. to deliver the next call regarding “Kinzo’s test” and then discards Kanon and Shannon, thus “killing” them (Fulfilling #1-2)</p><p>After this she meets up with George and shoots him in the head.</p><p>She then goes to meet with Jessica and convinces her that the entire thing was just a game (alternatively she is informed of the existence of the bomb and threatened into playing along, however I once again find the threat unnecessary). Jessica plays along, calls Battler and gives him information that she should not have, like that George was also dead or that she would die from a head wound. After the call is over Yasu shoots and then smashes her head open.</p><p>She returns to the mansion where Krauss, Kyrie and Nanjo are non the wiser. She tells them that George and Jessica also agreed to play along and hid themselves. Kyrie then delivers the final phone call, after which Yasu kills them and moves the bodies to their final locations/sets up the crime scenes to match Kyrie’s description.</p><p>When Battler doesn’t remember his “sin”, Yasu sets the bomb, goes to the well next to Nanjo’s corpse and uses the same trick as in EP2: She ties something heavy to the gun with a string, which is then lowered into the well. She then commits suicide and then the weight pulls the gun down into the well where it cannot be discovered. Note that the well has iron bars on it that cannot be opened at all (probably built into the concrete) just big enough for a handgun to fall through but not big enough for a person, meaning there is no way to get in or out of the well.</p><p>Maria was poisoned and laid to rest in the time between Battler moving over to the chapel and returning with the keys. By the time he enters the mansion Yasu had long since left through the back door.</p><p>Battler was killed by the bomb Yasu set up in advance that blew up the entire mansion, thus explaining all the final Red Truths of the episode regarding to Beatrice killing Battler.</p><p>And now the rest of the mysteries and questionable events:</p><h2>Maria’s umbrella</h2><h3>Description</h3><p>Maria claims that Kinzo gave her an umbrella when she was out in the rain in the rose garden.</p><h3>Explanation</h3><p>It was probably Krauss in disguise. He dressed up as Kinzo and acted like him in order to create a witness and thus throw the other siblings off-balance after the previous arguments over whether Kinzo was alive. It is quite possible that this was the moment where Yasu and Krauss first meet eye to eye (since usually this is the point where she would give Maria the letter of challenge) and where Yasu gives him her offer.</p><h2>The Family Conference</h2><p>Instead of Kinzo, it is Yasu that shows up at the conference and bribes the family and the servants to play along with her game in exchange for the gold. No one is killed at this point in time.</p><p>They all get the same basic cover story explained to them so that there would be no inconsistencies. Gohda and Kumasawa leave for the guest house to tell the cousins about the “events”. It is so that they would not move to the mansion and discover the “deception”.</p><p>In the meantime Krauss, Kyrie, Nanjo and Yasu leave for the chamber with the gold to prove her claim. These three are going because:</p><p>a.: Krauss is the eldest of the siblings and its his house, not to mention he is the one who first made contact with Yasu, so he is there to make sure she is telling the truth.</p><p>b.: Kyrie is there as the trusted representative of the rest of the siblings, and she is there to later talk to Battler in particular.</p><p>c.: Nanjo is there as a neutral third party to oversee the discovery of the gold and the later events.</p><p>The rest stays there to discuss what they were going to be doing with the money and whatnot.</p><p>After the confirmation of the gold (and the possible revelation of the bomb) the same group goes to a separate room to call the cousins as per Yasu instructs them.</p><h2>The First Phone Call</h2><h3>Description</h3><p>Krauss, Kyrie, Shannon, Kanon and Nanjo are locked in a “dungeon” from where they manage to call the cousins through the internal phone.</p><h3>Explanation</h3><p>This is the scene that makes it blatantly obvious that the entire group in the nonexistent dungeon (plus the two servants in the guest house) are in cahoots with Yasu. The call is only there to force the cousins to stay in the guest house so that they wouldn’t interfere with their plans, which as far as Krauss and Kyrie knew was just some eccentric but innocent murder-mystery game for Battler.</p><h2>&nbsp;</h2>"""
            )
    db.session.add(thread5)
    db.session.commit()


# Uses a raw SQL query to TRUNCATE or DELETE the users table. SQLAlchemy doesn't
# have a built in function to do this. With postgres in production TRUNCATE
# removes all the data from the table, and RESET IDENTITY resets the auto
# incrementing primary key, CASCADE deletes any dependent entities.  With
# sqlite3 in development you need to instead use DELETE to remove all data and
# it will reset the primary keys for you as well.
def undo_thread():
    if environment == "production":
        db.session.execute(f"TRUNCATE table {SCHEMA}.threads RESTART IDENTITY CASCADE;")
    else:
        db.session.execute(text("DELETE FROM threads"))

    db.session.commit()
